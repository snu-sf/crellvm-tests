CUDA Tests
==========

Cuda tests are enabled if cmake is invoked with
-DTEST_SUITE_EXTERNALS_DIR=<externals path> and specified externals
directory contains at least one CUDA installation.

Expected externals directory structure:
Externals/
  cuda/
    cuda-X.Y/  -- One or more CUDA installation.
    gcc-X.Y.Z/ -- One or more GCC installation for libstdc++.

export EXTERNALS=/your/externals/path
export CUDA_EXTERNALS=$EXTERNALS/cuda
export CLANG_DIR=/your/clang/build/dir
export TEST_SUITE_DIR=/path/to/test-suite-sources

* Externals installation
  For each cuda version:
    # bash cuda-linux64-rel-XXXXXX.run -prefix=$CUDA_EXTERNALS/cuda-7.5 -noprompt -nosymlink

  For each GCC version:
    * extract GCC sources and cd into gcc-X.Y.Z
    # ../configure --enable-languages=c,c++ --disable-libsanitizer
    # make bootstrap
    # make DESTDIR=$CUDA_EXTERNALS/gcc-X.Y.Z install

  Fetch thrust:
    # cd $CUDA_EXTERNALS
    # git clone https://github.com/thrust/thrust.git

* Configure, build and run tests
  Note that if externals are checked out into <test-suite>/test-suite-externals
  there's no need to specify location explicitly with -DTEST_SUITE_EXTERNALS_DIR=

  # mkdir test-suite-build-dir
  # cd test-suite-build-dir
  # PATH=$CLANG_DIR/bin:$PATH CXX=clang++ CC=clang \
    cmake -G Ninja -DTEST_SUITE_EXTERNALS_DIR=$EXTERNALS $TEST_SUITE_DIR 
  # ninja cuda-tests-all
  # lit -j1 Externals/CUDA

  For convenience there are top-level targets that would build only
  one particular variant of the tests:

    cuda-tests-<variant_suffix>

  where <variant_suffix> is <cuda-version>-<c++ std>-<libc++|libstdc++-version>

  Similarly individual test variants can be built using the same convention:

    <test_name>-<variant suffix>

  E.g: thrust-cuda-7.5-c++98-libstdc++-4.9.3 OR axpy-cuda-7.0-c++11-libc++
